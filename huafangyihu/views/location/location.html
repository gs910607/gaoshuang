<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="pragma" content="no-cache" />
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/main.css" />
		<link rel="stylesheet" type="text/css" href="../../css/location.css" />
		<style type="text/css">
			#allmap {
				width: 100%;
				height: 100%;
				overflow: hidden;
				margin: 0;
			}
		</style>
		<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=3kuyg6SrGTgmTe4ZAOYpKciZzEH9PArY"></script>
		<title>我的诊所</title>
	</head>

	<body>
		<header>
			<a id="goBack" class="goback" href="javascript:history.back();">
				<img src="../../images/backtrack.png" alt="" />
				<span id="goBackText">返回</span>
			</a>
			<h1 id="theme">诊所位置</h1>
		</header>

		<div id="allmap"></div>
	</body>
</html>
<script src="../../resource/js/jquery-2.1.1.min.js"></script>
<script src="../../resource/js/common.js"></script>

<script type="text/javascript">
	var defaultUrl =GetQueryStr("default");
	var hospitalId =GetQueryStr("hospitalId");
	var headerHeight = $("header").height() + 1;
	var mapHeight = $(document).height() - headerHeight * 2;
	$("#allmap").height(mapHeight);
	var longitude = sessionStorage.getItem("local_longitude");
	var latitude = sessionStorage.getItem("local_latitude");
	// 百度地图API功能
	var map = new BMap.Map("allmap");
	var point = new BMap.Point(longitude, latitude);
	map.centerAndZoom(point, 18);
	// 添加带有定位的导航控件
	var navigationControl = new BMap.NavigationControl({
		// 靠右下角位置
		anchor: BMAP_ANCHOR_BOTTOM_RIGHT,
		// LARGE类型
		type: BMAP_NAVIGATION_CONTROL_LARGE,
		// 启用显示定位
		enableGeolocation: true
	});
	var mk = new BMap.Marker(point);
	map.addOverlay(mk);
	map.panTo(point);
	map.addControl(navigationControl);
	// 添加定位控件
	var geolocationControl = new BMap.GeolocationControl();
	geolocationControl.addEventListener("locationSuccess", function(e) {
		// 定位成功事件
		var address = '';
		address += e.addressComponent.province;
		address += e.addressComponent.city;
		address += e.addressComponent.district;
		address += e.addressComponent.street;
		address += e.addressComponent.streetNumber;
		alert("当前定位地址为：" + address);
	});
	geolocationControl.addEventListener("locationError", function(e) {
		// 定位失败事件
		alert(e.message);
	});
	map.addControl(geolocationControl);

//	$("#goBack").on("click",function(){
//		$("header>a").attr("src","javascript:;")
//		if(defaultUrl){
//
//			location.href="../myClinic/clinicIndex.html?default=default&hospitalId="+hospitalId;
//		}else{
//			location.href="../myClinic/clinicIndex.html?hospitalId="+hospitalId;
//		}
//	})
</script>
